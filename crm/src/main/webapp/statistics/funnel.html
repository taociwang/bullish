<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/static/layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style>
        .divcss5-a{ line-height:22px}/* css 注释说明：设置行距行高22px */
        .divcss5-b{ line-height:40px}/* 设置行距行高22px */
        a:link {
            color:#1E9FFF;
        }
        a:hover {
            color:black;
            text-decoration:none;
        }
        #funnel{
            width: 400px;
            height: 280PX;
        }
        #tab{
            height: 280PX;
        }
        #funnel2{
            width: 400px;
            height: 280PX;
        }
        #tab2{
            height: 280PX;
        }
        #funnel3{
            width: 400px;
            height: 280PX;
        }
        #tab3{
            height: 280PX;
        }
        #funnel4{
            width: 400px;
            height: 280PX;
        }
        #tab4{
            height: 280PX;
        }
        #funnel5{
            width: 400px;
            height: 280PX;
        }
        #tab5{
            height: 280PX;
        }
    </style>
</head>
<body >
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>统计分析</legend>
</fieldset>

<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header"><b>分类</b></div>
                <div class="layui-card-body">
                    <div  class="divcss5-b">
                        <a href="/statistics/query.html">我的统计</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/week_statistics.do">本周统计</a><br>
                        <img class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/monthStatistics.do">本月统计</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/quarterStatistics.do">本季度统计</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/statistics/funnel.html">商机销售漏斗</a><br>
                        <img class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/industryStatistics.do">行业分布</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/sourceStatistics.do">商机来源</a><br>
                    </div>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br><br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
                <div class="layui-col-md4">
                    <div class="layui-card">
                       <!-- <div class="layui-card-header">所有商机</div>-->
                        <div class="layui-card-body" id="funnel">
                        </div>
                    </div>
                </div>
                <div class="layui-col-md5">
                    <div class="layui-card">
                        <!--<div class="layui-card-header">所有商机</div>-->
                        <div class="layui-card-body" id="tab">
                            <table id="funnelTable" border="1"  class="layui-table">
                                <tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <!-- <div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="funnel2">
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <!--<div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="tab2">
                        <table id="funnelTable2" border="1"  class="layui-table">
                            <tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <!-- <div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="funnel3">
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <!--<div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="tab3">
                        <table id="funnelTable3" border="1"  class="layui-table">
                            <tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <!-- <div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="funnel4">
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <!--<div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="tab4">
                        <table id="funnelTable4" border="1"  class="layui-table">
                            <tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <!-- <div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="funnel5">
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <!--<div class="layui-card-header">所有商机</div>-->
                    <div class="layui-card-body" id="tab5">
                        <table id="funnelTable5" border="1"  class="layui-table">
                            <tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="/static/js/jquery-3.3.1.js" charset="utf-8"></script>
<script src="/static/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script src="/static/js/echarts.min.js" charset="utf-8"></script>

<script>
    layui.use(['element', 'layer','table','util'], function(){
        var element = layui.element;
        var layer = layui.layer;
        var table = layui.table;
        var util = layui.util;

        //监听折叠
        element.on('collapse(test)', function(data){
            layer.msg('展开状态：'+ data.show);
        });
        option = {
            title: {
                text: '所有商机漏斗图',
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c}%"
            },
            legend: {
                data: []
            },
            calculable: true,
            series: [
                {
                    name:'漏斗图',
                    type:'funnel',
                    left: '10%',
                    top: 60,
                    //x2: 80,
                    bottom: 60,
                    width: '80%',
                    // height: {totalHeight} - y - y2,
                    min: 0,
                    max: 100,
                    minSize: '0%',
                    maxSize: '100%',
                    sort: 'descending',
                    gap: 2,
                    label: {
                        show: true,
                        position: 'inside'
                    },
                    labelLine: {
                        length: 10,
                        lineStyle: {
                            width: 1,
                            type: 'solid'
                        }
                    },
                    itemStyle: {
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    emphasis: {
                        label: {
                            fontSize: 20
                        }
                    },
                    data: [
                        {value: 60, name: '竞标投标'},
                        {value: 40, name: '商务谈判'},
                        {value: 20, name: '成交'},
                        {value: 80, name: '方案报价'},
                        {value: 100, name: '初次访问'}
                    ]
                }
            ]
        };

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/funnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var fun=window.document.getElementById("funnel");
                var content="<tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>";
                if (result) {
                    var con=result[result.length-1].count;
                    var su=result[result.length-1].sum;
                    for(var i=result.length-1;i>=0;i--){
                        var str=Number((result[i].count / con)*100).toFixed(2)+"%";
                        var str2=Number((result[i].sum / su)*100).toFixed(2)+"%";
                        content+="<tr><td>"+result[i].count+"</td><td>"+str+"</td><td>"+result[i].sum+"</td><td>"+str2+"</td></tr>";
                    }
                }
                window.document.getElementById("funnelTable").innerHTML=content;
                var fun = echarts.init(document.getElementById('funnel'));
                fun.setOption(option);
            },
            error : function(errorMsg) {
                console.log("请求数据失败!")
                //请求失败时执行该函数
                //alert("请求数据失败!");
                //myChart.hideLoading();s
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/yearFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var fun=window.document.getElementById("funnel2");
                var content="<tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var con=result[result.length-1].count;
                    var su=result[result.length-1].sum;
                    for(var i=result.length-1;i>=0;i--){
                        var str=Number((result[i].count / con)*100).toFixed(2)+"%";
                        var str2=Number((result[i].sum / su)*100).toFixed(2)+"%";
                        content+="<tr><td>"+result[i].count+"</td><td>"+str+"</td><td>"+result[i].sum+"</td><td>"+str2+"</td></tr>";
                    }
                }else{
                    content+="<tr><td colspan='4'>暂无数据</td></tr>";
                }
                window.document.getElementById("funnelTable2").innerHTML=content;
                var fun = echarts.init(document.getElementById('funnel2'));
                fun.setOption(option);
                fun.setOption({
                    title: {
                        text: '年度商机漏斗图'
                    },
                });
            },
            error : function(errorMsg) {
                console.log("请求数据失败!")
                //请求失败时执行该函数
                //alert("请求数据失败!");
                //myChart.hideLoading();s
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/lastYearFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var fun=window.document.getElementById("funnel3");
                var content="<tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var con=result[result.length-1].count;
                    var su=result[result.length-1].sum;
                    for(var i=result.length-1;i>=0;i--){
                        var str=Number((result[i].count / con)*100).toFixed(2)+"%";
                        var str2=Number((result[i].sum / su)*100).toFixed(2)+"%";
                        content+="<tr><td>"+result[i].count+"</td><td>"+str+"</td><td>"+result[i].sum+"</td><td>"+str2+"</td></tr>";
                    }
                }else{
                    content+="<tr><td colspan='4'>暂无数据</td></tr>";
                }
                window.document.getElementById("funnelTable3").innerHTML=content;
                var fun = echarts.init(document.getElementById('funnel3'));
                fun.setOption(option);
                fun.setOption({
                    title: {
                        text: '上年度商机漏斗图'
                    },
                });
            },
            error : function(errorMsg) {
                console.log("请求数据失败!")
                //请求失败时执行该函数
                //alert("请求数据失败!");
                //myChart.hideLoading();s
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/quarterFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var fun=window.document.getElementById("funnel4");
                var content="<tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var con=result[result.length-1].count;
                    var su=result[result.length-1].sum;
                    for(var i=result.length-1;i>=0;i--){
                        var str=Number((result[i].count / con)*100).toFixed(2)+"%";
                        var str2=Number((result[i].sum / su)*100).toFixed(2)+"%";
                        content+="<tr><td>"+result[i].count+"</td><td>"+str+"</td><td>"+result[i].sum+"</td><td>"+str2+"</td></tr>";
                    }
                }else{
                    content+="<tr><td colspan='4'>暂无数据</td></tr>";
                }
                window.document.getElementById("funnelTable4").innerHTML=content;
                var fun = echarts.init(document.getElementById('funnel4'));
                fun.setOption(option);
                fun.setOption({
                    title: {
                        text: '本季度商机漏斗图'
                    },
                });
            },
            error : function(errorMsg) {
                console.log("请求数据失败!")
                //请求失败时执行该函数
                //alert("请求数据失败!");
                //myChart.hideLoading();s
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/lastQuarterFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var fun=window.document.getElementById("funnel5");
                var content="<tr><td>商机数</td><td>百分比</td><td>金额</td><td>百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var con=result[result.length-1].count;
                    var su=result[result.length-1].sum;
                    for(var i=result.length-1;i>=0;i--){
                        var str=Number((result[i].count / con)*100).toFixed(2)+"%";
                        var str2=Number((result[i].sum / su)*100).toFixed(2)+"%";
                        content+="<tr><td>"+result[i].count+"</td><td>"+str+"</td><td>"+result[i].sum+"</td><td>"+str2+"</td></tr>";
                    }
                }else{
                    content+="<tr><td colspan='4'>暂无数据</td></tr>";
                }
                window.document.getElementById("funnelTable5").innerHTML=content;
                var fun = echarts.init(document.getElementById('funnel5'));
                fun.setOption(option);
                fun.setOption({
                    title: {
                        text: '上季度商机漏斗图'
                    },
                });
            },
            error : function(errorMsg) {
                console.log("请求数据失败!")
                //请求失败时执行该函数
                //alert("请求数据失败!");
                //myChart.hideLoading();s
            }
        })

    });
</script>

</body>
</html>