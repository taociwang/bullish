<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/static/layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style>
        .divcss5-a{ line-height:22px}/* css 注释说明：设置行距行高22px */
        .divcss5-b{ line-height:40px}/* 设置行距行高22px */
        a:link {
            color:#1E9FFF;
        }
        a:hover {
            color:black;
            text-decoration:none;
        }
        #funnel{
             width: 400px;
             height: 305PX;
         }
        #tab{
            height: 300PX;
        }
        #funnel2{
            width: 400px;
            height: 305PX;
        }
        #tab2{
            height: 300PX;
        }
        #funnel3{
            width: 400px;
            height: 305PX;
        }
        #tab3{
            height: 300PX;
        }
        #funnel4{
            width: 400px;
            height: 305PX;
        }
        #tab4{
            height: 300PX;
        }
        #funnel5{
            width: 400px;
            height: 305PX;
        }
        #tab5{
            height: 300PX;
        }
    </style>
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>统计分析</legend>
</fieldset>

<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header"><b>分类</b></div>
                <div class="layui-card-body">
                    <div  class="divcss5-b">
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/statistics/query.html">我的统计</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/weekStatistics.do">本周统计</a><br>
                        <img class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/monthStatistics.do">本月统计</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/quarterStatistics.do">本季度统计</a><br>
                        <img class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="">商机销售漏斗</a><br>
                        <img class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/industryStatistics.do">行业分布</a><br>
                        <img  class="img " src="http://www.axshare.cn/gsc/S3EWE1/0c/7f/0a/0c7f0a102aa0468792ba30e848859a83/images/客户管理/u214.png?token=7d4f9606a0b066bc039aba0635526beb861e54be091b943188e4da522c942e6b"/>
                        <a href="/sourceStatistics.do">商机来源</a><br>
                    </div>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>
                    <br><br><br><br><br><br>

                </div>
            </div>
        </div>
        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header"><b>商机数</b></div>
                    <div class="layui-card-body">
                        <div id="funnel" class="layui-inline" class="funnel-table">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <div class="layui-card-header"><b>商机数</b></div>
                    <div class="layui-card-body">
                        <div id="tab">
                            <table border="1" class="layui-table" id="funnelTable" class="funnel-table2">
                                <thead>
                                <tr>
                                    <td>商机数</td>
                                    <td>百分比</td>
                                    <td>金额</td>
                                    <td>百分比</td>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="funnel2" class="layui-inline" class="funnel-table">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="tab2">
                            <table border="1" class="layui-table" id="funnelTable2" class="funnel-table2">
                                <thead>
                                <tr>
                                    <td>商机数</td>
                                    <td>百分比</td>
                                    <td>金额</td>
                                    <td>百分比</td>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="funnel3" class="layui-inline" class="funnel-table">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="tab3">
                            <table border="1" class="layui-table" id="funnelTable3" class="funnel-table2">
                                <thead>
                                <tr>
                                    <td>商机数</td>
                                    <td>百分比</td>
                                    <td>金额</td>
                                    <td>百分比</td>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="funnel4" class="layui-inline" class="funnel-table">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="tab4">
                            <table border="1" class="layui-table" id="funnelTable4" class="funnel-table2">
                                <thead>
                                <tr>
                                    <td>商机数</td>
                                    <td>百分比</td>
                                    <td>金额</td>
                                    <td>百分比</td>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="funnel5" class="layui-inline" class="funnel-table">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md5">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div id="tab5">
                            <table border="1" class="layui-table" id="funnelTable5" class="funnel-table2">
                                <thead>
                                <tr>
                                    <td>商机数</td>
                                    <td>百分比</td>
                                    <td>金额</td>
                                    <td>百分比</td>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="/static/js/jquery-3.3.1.js" charset="utf-8"></script>
<script src="/static/layui/layui.js" charset="utf-8"></script>
<script src="/static/js/echarts.min.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['element', 'layer','table','util'], function(){
        var element = layui.element;
        var layer = layui.layer;
        var table = layui.table;
        var util = layui.util;

        //监听折叠
        element.on('collapse(test)', function(data){
            layer.msg('展开状态：'+ data.show);
        });
        var option={

            title: {
                text: '全部商机漏斗图',
                //subtext: '纯属虚构'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c}%"
            },
            legend: {
                data: []
            },
            // calculable: true,
            series: [
                {
                    name:'漏斗图',
                    type:'funnel',
                    left: '10%',
                    top: 60,
                    //x2: 80,
                    bottom: 60,
                    width: '80%',
                    // height: {totalHeight} - y - y2,
                    min: 0,
                    max: 100,
                    minSize: '0%',
                    maxSize: '100%',
                    sort: 'descending',
                    gap: 2,
                    label: {
                        show: true,
                        position: 'inside'
                    },
                    labelLine: {
                        length: 10,
                        lineStyle: {
                            width: 1,
                            type: 'solid'
                        }
                    },
                    itemStyle: {
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    emphasis: {
                        label: {
                            fontSize: 20
                        }
                    },
                    data:  [
                        {value: 20, name: '成交'},
                        {value: 80, name: '方案报价'},
                        {value: 60, name: '竞争者投标'},
                        {value: 40, name: '商务谈判'},
                        {value: 100, name: '初次沟通'}
                    ]
                }
            ]
        };

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/funnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var funnelTab=document.getElementById("funnelTable");
                //var funnelMap=document.getElementById("funnel");
                var content="<tr><td >商机数</td><td >百分比</td><td >金额</td ><td >百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var last=result[result.length-1];
                    var countLast=last.count;
                    var sumLast=last.sum;
                    for (var i = result.length-1; i >=0; i--) {
                        var con=Number((result[i].count / countLast)*100).toFixed(2) + '%';
                        var sn=Number((result[i].sum / sumLast)*100).toFixed(2) + '%';
                        content += "<tr><td>"+result[i].count+"</td><td>"+con+"</td><td>"+result[i].sum+"</td><td>"+sn+"</td></tr>";
                    }
                }
                funnelTab.innerHTML=content;

                var funnelMap=echarts.init(document.getElementById("funnel"));
                funnelMap.setOption(option);
            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                //alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/yearFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var funnelTab=document.getElementById("funnelTable2");
                //var funnelMap=document.getElementById("funnel");
                var content="<tr><td >商机数</td><td >百分比</td><td >金额</td ><td >百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var last=result[result.length-1];
                    var countLast=last.count;
                    var sumLast=last.sum;
                    for (var i = result.length-1; i >=0; i--) {
                        var con=Number((result[i].count / countLast)*100).toFixed(2) + '%';
                        var sn=Number((result[i].sum / sumLast)*100).toFixed(2) + '%';
                        content += "<tr><td>"+result[i].count+"</td><td>"+con+"</td><td>"+result[i].sum+"</td><td>"+sn+"</td></tr>";
                    }
                }
                funnelTab.innerHTML=content;

                var funnelMap=echarts.init(document.getElementById("funnel2"));
                funnelMap.setOption(option);
                funnelMap.setOption({
                    title: {
                        text: '本年度商机漏斗',
                        //subtext: '纯属虚构'
                    },
                });
            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                //alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/lastYearFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var funnelTab=document.getElementById("funnelTable3");
                //var funnelMap=document.getElementById("funnel");
                var content="<tr><td >商机数</td><td >百分比</td><td >金额</td ><td >百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var last=result[result.length-1];
                    var countLast=last.count;
                    var sumLast=last.sum;
                    for (var i = result.length-1; i >=0; i--) {
                        var con=Number((result[i].count / countLast)*100).toFixed(2) + '%';
                        var sn=Number((result[i].sum / sumLast)*100).toFixed(2) + '%';
                        content += "<tr><td>"+result[i].count+"</td><td>"+con+"</td><td>"+result[i].sum+"</td><td>"+sn+"</td></tr>";
                    }
                }
                funnelTab.innerHTML=content;

                var funnelMap=echarts.init(document.getElementById("funnel3"));
                funnelMap.setOption(option);
                funnelMap.setOption({
                    title: {
                        text: '上年度商机漏斗',
                        //subtext: '纯属虚构'
                    },
                });
            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                //alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/quarterFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var funnelTab=document.getElementById("funnelTable4");
                //var funnelMap=document.getElementById("funnel");
                var content="<tr><td >商机数</td><td >百分比</td><td >金额</td ><td >百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var last=result[result.length-1];
                    var countLast=last.count;
                    var sumLast=last.sum;
                    for (var i = result.length-1; i >=0; i--) {
                        var con=Number((result[i].count / countLast)*100).toFixed(2) + '%';
                        var sn=Number((result[i].sum / sumLast)*100).toFixed(2) + '%';
                        content += "<tr><td>"+result[i].count+"</td><td>"+con+"</td><td>"+result[i].sum+"</td><td>"+sn+"</td></tr>";
                    }
                }
                funnelTab.innerHTML=content;

                var funnelMap=echarts.init(document.getElementById("funnel4"));
                funnelMap.setOption(option);
                funnelMap.setOption({
                    title: {
                        text: '本季度商机漏斗',
                        //subtext: '纯属虚构'
                    },
                });
            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                //alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        })

        $.ajax({
            type : "post",
            async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
            url : "/lastQuarterFunnel.do",    //请求发送到TestServlet处
            data : {},
            dataType : "json",        //返回数据形式为json
            success : function(result) {
                //请求成功时执行该函数内容，result即为服务器返回的json对象
                var funnelTab=document.getElementById("funnelTable5");
                //var funnelMap=document.getElementById("funnel");
                var content="<tr><td >商机数</td><td >百分比</td><td >金额</td ><td >百分比</td></tr>";
                if (null!=result&&result.length>0) {
                    var last=result[result.length-1];
                    var countLast=last.count;
                    var sumLast=last.sum;
                    for (var i = result.length-1; i >=0; i--) {
                        var con=Number((result[i].count / countLast)*100).toFixed(2) + '%';
                        var sn=Number((result[i].sum / sumLast)*100).toFixed(2) + '%';
                        content += "<tr><td>"+result[i].count+"</td><td>"+con+"</td><td>"+result[i].sum+"</td><td>"+sn+"</td></tr>";
                    }
                }
                funnelTab.innerHTML=content;

                var funnelMap=echarts.init(document.getElementById("funnel5"));
                funnelMap.setOption(option);
                funnelMap.setOption({
                    title: {
                        text: '上季度商机漏斗',
                        //subtext: '纯属虚构'
                    },
                });
            },
            error : function(errorMsg) {
                //请求失败时执行该函数
                //alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        })
    });
</script>

</body>
</html>